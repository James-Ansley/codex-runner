# Codex Runner

Scripts to assist in using OpenAI Codex to generate completions to questions.

## Usage

You must have docker running on your machine to run the automatic checking
functionality of these scripts.

### Available Commands:

```text
Usage: codex_runner.py [OPTIONS] COMMAND [ARGS]...

Options:
  --help                          Show this message and exit.

Commands:
  gen      Generates Completions
  check    Runs questions with completions against test cases.
  summary  Generates summary CSV file
```

### Command: `gen`

```text
Usage: codex_runner.py gen [OPTIONS] IN_ OUT

  Generates Completions

Arguments:
  IN_  Input TOML file path  [required]
  OUT  Output TOML file path  [required]

Options:
  --n INTEGER   Number of completions to generate  [default: 1]
  --temp FLOAT  Temperature to use when generating completions  [default: 0.9]
  --help        Show this message and exit.
```

e.g.

```text
python codex_runner.py gen data/qdata.toml data/qdata_comp.toml --n 10
```

### Command: `check`

```text
Usage: codex_runner.py check [OPTIONS] IN_ OUT

  Runs questions with completions against test cases.

Arguments:
  IN_  Input TOML file path with completions  [required]
  OUT  Output TOML file path  [required]

Options:
  --help  Show this message and exit.
```

e.g.

```text
python codex_runner.py check data/qdata_comp.toml data/qdata_checked.toml
```

### Command: `summary`

```text
Usage: codex_runner.py summary [OPTIONS] IN_ OUT

  Generates summary CSV file

Arguments:
  IN_  Input TOML file path with scored completions  [required]
  OUT  Output CSV file path  [required]

Options:
  --help  Show this message and exit.
```

e.g.

```text
python codex_runner.py summary data/qdata_checked.toml data/results.csv
```

### Question Format

To start, question data must be added to a TOML file that contains for each
question:

- A unique ID
- A prompt
- An answer preload
- Several testcases each containing:
    - Code
    - Stdin
    - Expected output

Additional data will be generated by these scripts that does not need to be
manually added.

The general TOML format is as follows:

```toml
# You can have several questions in one file
[[questions]]
id = 'greeting'
prompt = '''
Write a function called greeting(name) that takes a name as input and prints Hello, <name>! as in the examples below.

>>> greeting("James")
Hello, James!
>>> greeting("Sue")
Hello, Sue!
'''
answer_preload = '''
def greeting(name):
'''

# Generated by running the gen and check commands
# You do not need to write these yourself
[[questions.completions]]
code = '''
# Python 3
def greeting(name):
    print(f"Hello, {name}!")
'''
[[questions.completions.test_results]]
code = '''
greeting("James")
'''
stdin = ''
expect = '''
Hello, James!
'''
got = '''
Hello, James!
'''
[[questions.completions.test_results]]
code = '''
greeting("Sue")
'''
stdin = ''
expect = '''
Hello, James!
'''
got = '''
Hello, Sue!
'''

# You will need to write testcases yourself
[[questions.testcases]]
code = '''
greeting("James")
'''
stdin = ''
expect = '''
Hello, James!
'''

[[questions.testcases]]
code = '''
greeting("Sue")
'''
stdin = ''
expect = '''
Hello, Sue!
'''
```
